# 웹 요청 흐름

### **웹 통신의 흐름**

www.google.com 주소창에 해당 URL을 입력한 뒤 클라이언트에 화면이 렌더링 되기까지 어떤 과정이 있을까?

**1) 사용자가 웹브라우저 검색창에 www.google.com 입력**

**2) 웹브라우저는 해당 도메인 주소와 상응하는 IP 주소를 찾기 위해  캐싱된 DNS 기록을 확인**

1. 이때, 브라우저는 DNS 기록을 찾기 위해 browser → OS → router → ISP 순으로 확인한다.
2. 이 단계에서 캐싱된 기록에 없을 경우, 다음단계로 넘어간다.

**3) 만약 캐시가 없다면 ISP의 DNS 서버는 IP주소를 찾기 위해 DNS query를 시작**

1. DNS 쿼리는 IP주소를 찾을 때까지 반복한다. (**recursive search**)
2. DNS를 통해 IP 주소를 응답받는 과정은 위 **Point 1**에서 설명하여 넘어간다.

**4) DNS가 웹브라우저에게 찾는 사이트의 IP주소를 응답**

**5) IP 주소를 받으면 일반적으로 TCP 통신을 시작**

- TCP 연결은 을 통해 만들어진다.
    
    TCP/IP three-way handshake 과정
    

**6) HTTP 프로토콜로 요청**

- TCP로 연결이 되면, 브라우저는 GET요청을 통해 서버에게 www.google.com의 웹페이지를 요구한다.

**6) 웹 어플리케이션 서버(WAS)와 데이터베이스에서 우선 웹페이지 작업 처리**

- 웹 서버 혼자서 모든 로직 처리 및 데이터 관리를 하게되면 서버에 과부하가 일어날 가능성이 높다. 그렇기에 서버의 일을 돕는 조력자 역할을 하는 것이 WAS다.

> 웹서버 : 정적인 컨텐츠(HTML, CSS, IMAGE 등)를 요청받아 처리하여 제공하는 서버
> 

> WAS : 동적인 컨텐츠(JSP, ASP, PHP 등)를 요청받아 처리하여 제공하는 서버 => 주로 DB서버와 함께 사용
> 

![image](https://blog.kakaocdn.net/dn/bUzlEa/btrVeWhajQq/SiBWhCtJOxYEn64boAWhp0/img.png)

**7) WAS에서의 작업 처리 결과들을 웹 서버로 전송**

**8) 웹서버는 웹브라우저에게 html 문서 결과를 응답**

응답 status code로 서버 요청에 따른 상태를 보낸다.

알아야할 응답 코드 

### **2xx** : response 성공

- **200(Ok)** : 응답 코드는 요청이 성공했음을 나타냅니다. 200 응답은 기본적으로 캐시 가능.
- **201**(**Create)** :  요청이 성공하여 리소스가 생성되었음을 나타냄. 새로 생성된 항목은 요청 URL 또는 URL에 있는 메시지 본문에 반환됨.

### 3xx : 클라이언트를 다른 URL로 리다이렉트

- **301(Moved Permanently)** : 혹은 영구이동(Permanently Moved)는 해당 URL이 영구적으로 새로운 URL로 변경되었음을 나타냄. 검색엔진 크롤러는 301 요청을 만나면 컨텐트가 완전히 새로운 URL로 영원히 이동했다고 판단한다.
- **302(Found)** : 요청한 리소스가 임시적으로 새로운 URL로 이동했음(Temporarily Moved)을 나타냄.  따라서 검색엔진은 페이지랭킹이나 링크에 대한 점수를 새로운 URL로 옮기지 않으며 기존 URL을 그대로 유지한다. 즉 검색엔진이 기존 URL이 보유한 페이지랭킹 점수는 그대로 유지하도록 하면서 컨텐트만 새로운 URL에서 조회하도록 해야할 때 유용하다.
    - **302를 써야할 때** : 제품이 일시적으로 재고가 떨어지거나 혹은 한정적으로 판매하는 제품이 있다고 가정했을 때. 해당 제품이 보유한 사이트랭크를 유지하면서 사용자에게 일시적으로 제품이 품절됐음을 알리려면 한다면 이럴 때 301로 영구이동 시키는 대신 302를 사용하여 검색엔진은 일시적으로 해당 URL의 사이트랭크는 보존하게 되며 사용자는 새로운 URL의 컨텐트를 보게 한다.

### **4xx** : 클라이언트 측에서 에러 발생

- **400(BadRequest)** : 응답 상태 코드는 서버가 클라이언트 오류(예: 잘못된 요청 구문, 유효하지 않은 요청 메시지 프레이밍, 또는 변조된 요청 라우팅) 를 감지해 요청을 처리할 수 없거나, 하지 않는다는 것을 의미.
- **401(Unauthorized)** : 요청된 리소스에 대한 유효한 인증 자격 증명이 없기 때문에 클라이언트 요청이 완료되지 않았음을 나타냄.
- **403(Forbidden)** : 서버에 요청이 전달되었지만, 권한 때문에 거절되었다는 것을 의미함.
- **404(NotFound)** : 서버가 요청받은 리소스를 찾을 수 없다는 것을 의미합니다. 404 페이지를 띄우는 링크는 대체로 브로큰 링크(broken link) 또는 데드 링크(dead link)라고 부른다.
- **405(MethodNotAllowed)** : 서버가 요청 메서드를 알고 있지만 대상 리소스가 이 메서드를 지원하지 않음을 가리킨다.
- **406(NotAcceptable)** : 서버가 요청의 주도적인 컨텐츠 협상 헤더에 정의된 허용 가능한 값 목록과 일치하는 응답을 생성할 수 없으며, 서버가 기본 표현을 제공하지 않음을 나타냅니다.
    - ※ 컨텐츠 협상 : 사용자에게 가장 알맞는 형태의 리소스를 받을 수 있도록, 리소스를 어떤 형태로 받을지 정할 수 있도록하게 하는 메커니즘. 이때 리소스의 형태는 문서의 언어나, 이미지의 포맷이나, 콘텐츠의 인코딩에 해당하는 부분을 말한다.
- **407(ProxyAuthenticationRequired)** : 요청된 리소스에 액세스할 수 있는 서버와 브라우저 사이에 있는 프록시 서버에 대한 유효한 인증 자격 증명이 부족하기 때문에 요청이 적용되지 않았음을 나타냅니다 .
- **408(RequestTimeout)** : 서버가 사용하지 않는 연결을 종료하려고 함을 의미. *클라이언트의 이전 요청 없이도* 일부 서버에서 유휴 연결로 전송됨
- **409(Conflict)** : 요청이 대상 리소스의 현재 상태와 충돌함을 나타냄.
- **429(TooManyRequests)** : 사용자가 주어진 시간 동안 너무 많은 요청을 보냈음을 나타냄("속도 제한").

### 5xx : 서버 측에서 에러 발생

- **500(InternalServerError)** : 서버가 요청을 이행하지 못하게 하는 예상치 못한 상황을 의미 서버 오류.
- **502(BadGateway)** : 서버가 게이트웨이 또는 프록시 역할을 하는 동안 업스트림 서버로부터 잘못된 응답을 받았음을 나타냄.

**9) 웹브라우저는 html 컨텐츠를 표시**

---

### **Point 3 : 웹 서버와 WAS**

### **1) 웹 서버**

> 정적인 컨텐츠(HTML, CSS, IMAGE 등)를 요청받아 처리하여 제공하는 서버
> 
- 웹 서버는 정적인 컨텐츠만 처리할 수 있기 때문에 동적 컨텐츠를 요청받았을 때 WAS에게 요청하고 응답받아 클라이언트에게 전달해준다.

**Web Server의 예**

: **Apache** Server, **Nginx** 등

### **2) WAS (Web Application Server)**

> 동적인 컨텐츠(JSP, ASP, PHP 등)를 요청받아 처리하여 제공하는 서버 (+정적 리소스 제공 가능)
> 
- 웹 서버(Web Server)와 웹 컨테이너(Web Container)가 합쳐진 형태
- HTTP를 통해 컴퓨터나 장치에 애플리케이션을 수행해주는 미들웨어
- 주로 DB 서버와 함께 사용

**WAS의 예**

: **Tomcat**, JBoss, Jeus, Web Sphere 등

**WAS의 필요성**

웹 페이지는 정적 컨텐츠와 동적 컨텐츠가 모두 존재한다.

사용자의 요청에 맞게 적절한 동적 컨텐츠를 만들어서 제공해야 한다. 예를 들어 로그인 정보에 따라 화면에 표시되는 이름은 변경될 수 있다.

이때, Web Server만을 이용한다면 사용자가 원하는 요청에 대한 결과값을 모두 미리 만들어 놓고 서비스를 해야 한다. 하지만 이렇게 수행하기에는 자원이 절대적으로 부족하다.

따라서 WAS를 통해 요청에 맞는 데이터를 DB에서 가져와서 비즈니스 로직에 맞게 그때 그때 결과를 만들어서 제공함으로써 자원을 효율적으로 사용할 수 있다.

![image](https://blog.kakaocdn.net/dn/0tTli/btrValhSBMe/LQ1H7jPXw8k0MQFSKIp4b0/img.png)

**웹 시스템 구성**

**[ WAS + DB ]**

- WAS는 동적, 정적 컨텐츠를 모두 제공할 수 있기 때문에 웹 서버(Web Server)가 없이 시스템을 구성할 수 있다.
- 하지만 WAS에 모든 역할이 부여되었을 경우 서버 과부하로 가장 비싼 애플리케이션 로직이 정적 리소스로 인해 수행이 어려울 수 있다는 우려가 있다.

**예상 질문**

www.google.com을 접근하면 어떤 일이 일어나는가

http 상태 메시지에 어떤게 있는가. 아는데로 말하기