### **CORS**

---

브라우저는 기본적으로 SOP 정책을 따른다.

- Same Origin Policy
- 한 origin에서 로드된 문서 또는 스크립트가 다른 origin의 리소스와 상호작용할 수 있는 방법을 제한하는 보안 메커니즘
- CSRF, XSS와 같은 공격에 대한 취약점에 대응하기 위한 정책

이러한 불편함을 해소하면서 보안을 유지하기 위한 정책이 **CORS**

- 도메인이 다른 서버끼리 리소스를 주고 받을 때 보안을 위해 설정
- 프로토콜, 호스트, 포트가 같은 경우 같은 오리진, 같은 출처로 인정 - Same origin
- 셋 중 하나라도 다를 경우 다른 출처로 판단된다. - Cross origin

![CORS](./이미지/image%201.png)
[https://velog.io/@effirin/CORS란-무엇인가](https://velog.io/@effirin/CORS%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)

<aside>
💡 CORS는 서버단이 아닌 브라우저에 구현되어 있는 스펙

- 서버에서 특정 출처의 요청만 처리하는 로직이 구현되어 있지 않다면 서버는 요청을 정상 처리
- 브라우저에서 응답을 받고 CORS 정책에 위반되었다고 판단하면 응답을 파기
- 서버 쪽에서는 정상적으로 처리되었다고 로그가 뜨기 때문에 제대로 이해하지 못하면 에러 파악에 문제가 생길 수 있다.
</aside>

**동작 시나리오**

1. HTTP 프로토콜을 사용하여 요청을 전송, 이때 Origin에 출처를 담음
2. 서버가 요청을 처리하고 응답을 할 때 Access-Control-Allow-Origin 값에 리소스 접근을 허용하는 출처를 담아 전송
3. 브라우저는 응답을 받고 Origin과 Access-Control-Allow-Origin을 비교하고 응답을 파기할지 사용할지 결정

**Preflight Request**

- 요청을 예비 요청과 본 요청으로 나누어 보내는 방식
- OPTIONS 메소드를 통해 서버가 요청을 보내는게 안전한지 확인
- 서버는 preflight에 대한 응답으로 서버가 허용하고 있는 정보를 response header에 담아 응답
- 브라우저는 이를 통해 본요청을 보내는 것이 안전한지 파악하고 결정한다.