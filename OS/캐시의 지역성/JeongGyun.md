# 운영체제(OS) 캐시 지역성
메모리 계층 구조
캐시 메모리란?
> 두 구성요소 간 엑세스 시간이나 전송 속도가 차이가 큰 경우 성능을 `향상하기 위해` 사용하는 하드웨어 캐시 혹은 메모리

![스크린샷 2024-05-24 오후 11 52 28](https://github.com/5dotseven/cs-basic-study/assets/144773042/71a80fc7-34a7-48c5-aed9-6ef38caac51f)


케시메모리는 메모리랑 비교하면
- 용량은 작고
- 속도는 빠르며
- 비쌈

주로 CPU 내부에 배치되어 있음

## 왜 생긴걸까?

메민메모리는 CPU의 성능이 점차 증가함에 따라 CPU와의 속도 격차가 현저히 벌어지게 됨 (CPU가 훨씬 빠름)
따라서 메인메모리는 CPU가 요구하는 만큼 `빠르게 데이터를 전달 할 수가 없음`

즉, 데이터 접근 시간을 줄이는게 필요

-> 메인 메모리보다 접근 속도가 빠른 저장장치 `캐시` 를 CPU와 메인메모리 사이에 두는걸로 해결
-> 메인 메모리에 접근 X -> 캐시에 접근해서 데이터를 가져옴 -> 접근 시간 줄이기 성공 속도 업

## 동작 원리
- 정보는 저장장치에 보관됨, 정보를 사용할 떄 보다 빠르게 하기위해서 캐시를 쓰는거임
- 따라서 캐시는 메모리에 있는 정보들을 복사해서 사용

하지만, 메인 메모리에 비해서 캐시는 `저장용량의 크기가 작음` 그리고 `비쌈`
>한정적인 공간을 효율적으로 사용하기위해 메인메모리에 데이터를 선별할 수 있어야한다.

여기서 사용되는게 데이터의 지역성(Locality)

다시 정리해보면
CPU에서 요청 -> 우선적으로 캐시에 정보가 있는지 검사(캐싱라인)
- 데이터가 캐시 내에 존재한다면 Cache Hit
- 데이터가 캐시 내에 없다면 메인 메모리에서 가져와야함 Cache Miss
  이때 이 정보가 다음에 다시 사용될 확률이 높다면? 그 정보를 캐시에 넣어둠


### 지역성
전제조건: 프로그앰은 모든 코드나 데이터에 대해 지역성을 가진다
- 모든 데이터를 균등하게 참조 X
- 일부 특정 데이터에 대해서 더 많이 참조하는 경향이 있음

**시간 지역성(Temporal Locality)** : 한 번 참조된 데이터는 잠시 후에 또 참조될 가능성이 높음. (ex. 반복문의 조건에 해당하는 변수)
-> 최근에 사용된거니 데이터가 다시 사용 될 가능성이 높다.

**공간 지역성(Spatial Locality)** : 참조된 데이터의 근처에 있는 데이터가 참조될 가능성이 높음. (ex. 배열 요소에 대한 연속 접근)
-> 최근에 사용된 데이터에 근처에 있다면 다시 사용 될 가능성이 높다.

> 적중률을 높인다.


### 캐싱라인
캐시에 정보가 있는지 없는지 검사할때 모든 데이터를 다 찾아서 한다면? -> 탐색 시간이 너무 오래걸림
이걸 해결하기 위해 있는 자료구조가 `캐싱라인`

>캐시에 있는 정보를 요청했을 때 바로 매핑 시겨줄 수 있도록 하는 것

3가지 종류
- Directed Mapped Cache
    - 메인 메모리 주소(N) : 캐시 메모리 주소(1)
    - 구현이 간단하고 속도가 빠름
    - Miss시 Conflict 확률이 올라감
- Fully Associative Cache
    - 메인메모리의 주소가 캐시에 어디든 할당 가능한 구조
    - 할당하는 것이 간단하고 빠름
    - 하지만 캐시 전체를 탐색하기 때문에 오래걸린다
- k-way Set Associative Cache
    - 앞에 2가지에 중간 느낌
    - 특정 데이터가 k-way만큼 할당 가능한 캐시 인덱스를 가짐
    - Hit여부를 판단하려면 k개의 블록을 체그하면 됨


