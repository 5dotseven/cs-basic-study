# 사용자 수준 스레드와 커널 수준 스레드

## 멀티스레드 모델

멀티 스레드 모델은 커널 스레드(kernel-level thread)와 사용자 스레드(user-level thread)로 나뉜다. **커널 스레드는 OS의 커널이 직접 쓰레드를 생성하고 관리**하는 방식이고, 사**용자 스레드는 라이브러리(프로그래밍 언어의 라이브러리)에 의해 구현된 스레드 모델**이다. 커널 스레드와 사용자 스레드의 대응 방식은 1 to N 모델, 1 to 1 모델, M to N 모델로 분류된다.

### 커널  수준의 쓰레드

- 쓰레드 패키지를 운영체제의 커널에 의해 관리된다.
- 응용 프로그램들이 운영체제에 영향을 받아 이식성이 낮다.

### 사용자 수준의 쓰레드

- 쓰레드 패키지를 런타임 시스템에서 운영함으로 운영체제는 하나의 프로세스로 인식한다.
- 쓰레드를 운영하지 않는 운영체제제에서 실행할 수 있어 이식성이 뛰어나다.

## 사용자 스레드(1 to N 모델)

- 커널이 멀티스레드들 지원하지 않을 때 사용하는 방법
- 초기의 스레드 시스템에서 사용되었음.
- 사용자 스레드 라이브러리를 사용하여 스레드를 구현된다.
- 사용자 스레드 라이브러리가 커널에서 지원하는 스케줄링이나 동기화 기능을 대신 수행함.
- 커널 입장에서는 사용자 스레드가 몇 개든 하나의 프로세스로 보임.
- 사용자 스레드는 사용자 프로세스 내에 여러 개의 스레드가 커널 하나와 연결되어 있다.
    - 때문에 1 to N 모델이라고 한다.
- 사용자 스레드는 라이브러리가 직접 스케줄링하고 작업에 필요한 정보를 처리하기 때문에 OS에선 커널에서 실행하던  컨텍스트 스위칭이 필요 없어 문맥 교환과 같은 부가적인 작업이 줄어들어 **속도가 빠르다.**

### 단점 :

- 커널 스레드가 입출력 작업을 등을 위해 대기 상태에 들어가면 모든 사용자 스레드가 같이 대기하게 된다는 것이다.
- 커널은 하나의 프로세스에 하나의 스레드가 할당 됨으로 내부의 할당된 일부의 사용자 스레드만 대기 상태로 보낼 수 없기 때문.
- 한 프로세스의 타임 슬라이스를 여러 스레드가 공유하기 때문에 멀티 프로세서에서 동시에 사용할 수 없다
- CPU를 여러 개 갖추고 커널이 멀티스레드를 지원하는 환경일 경우 스레드를 여러 CPU에 나누어 작업시키는 것이 가능지만,
- 사용자 스레드 모델에서는 커널이 여러 사용자 스레드를 하나의 프로세스 및 하나의 스레드로 인식되므로 작업을 나눌 수 없다.
- 사용자 스레드는 보안에 취약하다. 커널 레벨에서는 공유 데이터를 보호하는 장치가 있으나 이러한 서비스를 커널이 아닌 라이브러리에서 구현해야 하기 때문.

## 커널 스레드(1 to 1 모델)

- 커널 스레드는 커널이 멀티스레드를 지원하는 방식으로, 하나의 사용자 스레드가 하나의 커널 스레드와 연결되기 때문에 1 to 1 모델이라고 부른다.
- 커널 스레드는 독립적으로 스케줄링되므로 특정 스레드가 대기 상태에 들어가도 다른 스레드는 작업을 계속할 수 있다. 또한, 커널이 제공하는 보호 기능과 같은 모든 기능을 사용할 수 있다.
- 커널 스레드는 커널 레벨에서 모든 작업을 지원하기 때문에 멀티 CPU를 사용할 수 있다.
- 하나의 스레드가 대기 상태에 있어도 다른 스레드는 작업을 계속할 수 있다.

### 단점:

- 문맥 교환을 할 때 오버헤드 때문에 느리게 작동한다.
- 스레드의 자원 효율이 사용자스레드보다 좋지 못하다.

## 멀티레벨 스레드(M to N 모델)

- 사용자 스레드와 커널 스레드를 혼합한 방식으로 M to N 모델이라고 한다.
- 사용자 스레드에서는 커널 스레드의 개수가 사용자 스레드보다 적기 때문에 멀티레벨 스레드에서는 커널 스레드의 개수가 사용자 스레드보다 적다.
- 멀티레벨 스레드는 사용자 스레드와 커널 스레드 방식을 혼용하기 때문에 사용자 스레드와 커널 스레드의 장단점을 공유한다.
- 하나의 커널 스레드가 대기 상태에 들어가면 다른 커널 스레드가 대신 작업을 하여 사용자 스레드보다 유연하게 작업을 처리할 수 있다.

### 사용 환경 :

- 커널 스레드를 같이 사용하기 때문에 커널 스레드 환경에선 여전히 문맥 교환 시 오버헤드가 있지만. 상황에 맞춰 사용자스레드와 커널 스레드의 장점을 살릴 수 있게 혼합하여 사용할 수 있다.
- 빠르게 컨텍스트 스위칭을 해야하는 환경에선 사용자 스레드로 작동하고, 안정적으로 움직여야 하거나 입출력 등 사용자 스레드 모델이 적합하지 않은 스레드는 커널 스레드로 작동시킨다.